CREATE TABLE languages 
(
    language_id INTEGER GENERATED BY DEFAULT AS IDENTITY,
    name VARCHAR(32) NOT NULL,
    code VARCHAR(5) NOT NULL,
    sort_order INTEGER NOT NULL DEFAULT 0,
    status BOOLEAN NOT NULL DEFAULT FALSE,
    CONSTRAINT pk_languages PRIMARY KEY (language_id),
    CONSTRAINT uq_languages_code UNIQUE (code)
);

INSERT INTO languages (language_id, name, code, sort_order, status) VALUES 
(1, 'English', 'en', 0, TRUE),
(2, 'Deutsch', 'de', 1, TRUE);

CREATE TABLE user_groups
(
    user_group_id INTEGER GENERATED BY DEFAULT AS IDENTITY,
    name VARCHAR(50) NOT NULL,
    active_directory_group_cn VARCHAR(255) NOT NULL DEFAULT '',
    CONSTRAINT pk_user_groups PRIMARY KEY (user_group_id)
);

INSERT INTO user_groups (user_group_id, name, active_directory_group_cn) VALUES 
(1, 'Administrators', ''),
(2, 'Users', '');

CREATE TABLE users
(
    user_id INTEGER GENERATED BY DEFAULT AS IDENTITY,
    user_group_id INTEGER,
    username VARCHAR(50) NOT NULL,
    display_name VARCHAR(100) NOT NULL,
    active_directory_guid UUID,
    email VARCHAR(255) NOT NULL,
    password VARCHAR(255) NOT NULL,
    salt VARCHAR(255) NOT NULL,
    origin VARCHAR(5) NOT NULL,
    CONSTRAINT pk_users PRIMARY KEY(user_id),
    CONSTRAINT fk_users_user_group FOREIGN KEY(user_group_id) REFERENCES user_groups(user_group_id) ON DELETE SET NULL ON UPDATE CASCADE
);

CREATE TABLE permissions
(
    permission_id INTEGER GENERATED BY DEFAULT AS IDENTITY,
    identifier VARCHAR(50) NOT NULL,
    CONSTRAINT pk_permissions PRIMARY KEY (permission_id)
);

INSERT INTO permissions (permission_id, identifier) VALUES 
(1, 'EDIT_FORMS'),
(2, 'EDIT_ENTRIES'),
(3, 'EDIT_USERS'),
(4, 'DELETE_FORMS'),
(5, 'DELETE_ENTRIES'),
(6, 'EDIT_STATUS');

CREATE TABLE permission_descriptions
(
    permission_id INTEGER NOT NULL,
    code VARCHAR(5) NOT NULL DEFAULT '',
    name VARCHAR(50) NOT NULL,
    description text NOT NULL,
    CONSTRAINT pk_permission_descriptions PRIMARY KEY(permission_id, code),
    CONSTRAINT fk_permission_descriptions_permissions FOREIGN KEY (permission_id) REFERENCES permissions(permission_id) ON DELETE CASCADE ON UPDATE CASCADE
);

INSERT INTO permission_descriptions (permission_id, code, name, description) VALUES
(1, 'en', 'Form management','Allows the user the create, edit and delete new form templates.'),
(2, 'en', 'Submitted forms management','Allows the user the edit submitted form entries.'),
(3, 'en', 'User management','Allows the user to manage the users.'),
(4, 'en', 'Delete forms','Allows the user to entire forms.'),
(5, 'en', 'Delete Entries','Allows the user to delete submitted form entries.'),
(6, 'en', 'Status management','Edit and create new statuses.'),
(1, 'de', 'Formularverwaltung','Anlegen und bearbeiten von Formularen.'),
(2, 'de', 'Formulareinträge ','Bearbeitung aller Formulareinträge.'),
(3, 'de', 'Benutzerverwaltung','Bearbeitung und Anlegen von Nutzern.'),
(4, 'de', 'Formulare löschen','Erlaubt es dem Benutzer Formulare zu löschen.'),
(5, 'de', 'Formulareinträge löschen','Erlaubt es dem Benutzer Formulareinträge zu löschen.'),
(6, 'de', 'Statusverwaltung','Erstellen und Bearbeiten von Stati.');


